<!-- Add this script section to replace localStorage with API calls -->
<script>
// API Base URL
const API_BASE = '/api';

// Load services from API
async function loadUpcomingServices() {
    try {
        const response = await fetch(`${API_BASE}/services.php`);
        const services = await response.json();
        
        const container = document.getElementById('upcoming-services-container');
        
        if (services.length === 0) {
            container.innerHTML = '<p class="text-center text-silver">No upcoming services at this time.</p>';
            return;
        }
        
        container.innerHTML = services.map(service => `
            <div class="card-bg rounded-lg p-6 mb-6">
                <div class="flex flex-col md:flex-row md:items-center justify-between mb-4">
                    <h3 class="text-xl font-bold">${service.name}</h3>
                    <div class="text-silver mt-2 md:mt-0">Service: ${formatServiceDate(service.service_date)}</div>
                </div>
                <p class="text-silver mb-4">${service.description}</p>
                <div class="flex flex-wrap gap-4">
                    ${service.livestream_url ? `<a href="${service.livestream_url}" target="_blank" class="text-silver hover:text-white transition-all flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                        </svg>
                        Watch Livestream
                    </a>` : ''}
                    ${service.condolences_url ? `<a href="${service.condolences_url}" target="_blank" class="text-silver hover:text-white transition-all flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        Leave Condolences
                    </a>` : ''}
                    <span class="text-silver hover:text-white transition-all flex items-center cursor-pointer">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        ${service.location}
                    </span>
                </div>
            </div>
        `).join('');
    } catch (error) {
        console.error('Error loading services:', error);
        document.getElementById('upcoming-services-container').innerHTML = 
            '<p class="text-center text-silver">Unable to load services at this time.</p>';
    }
}

// Load blog posts from API
async function loadBlogPosts() {
    try {
        const response = await fetch(`${API_BASE}/blog.php`);
        const posts = await response.json();
        
        const container = document.getElementById('blog-posts-container');
        
        if (posts.length === 0) {
            container.innerHTML = '<p class="text-center text-silver">No blog posts available at this time.</p>';
            return;
        }
        
        container.innerHTML = posts.map(post => `
            <div class="card-bg rounded-lg p-6 mb-6">
                <h3 class="text-xl font-bold mb-2">${post.title}</h3>
                <p class="text-silver text-sm mb-4">Posted on ${new Date(post.created_at).toLocaleDateString()}</p>
                <p class="text-silver mb-4">${post.excerpt}</p>
                <a href="#" class="text-silver font-medium hover:text-white transition-all">Read more â†’</a>
            </div>
        `).join('');
    } catch (error) {
        console.error('Error loading blog posts:', error);
        document.getElementById('blog-posts-container').innerHTML = 
            '<p class="text-center text-silver">Unable to load blog posts at this time.</p>';
    }
}

// Submit arrangement form to API
document.getElementById('arrangement-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const arrangement = Object.fromEntries(formData.entries());
    
    try {
        const response = await fetch(`${API_BASE}/arrangements.php`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(arrangement)
        });
        
        const data = await response.json();
        
        if (response.ok) {
            document.getElementById('form-success').classList.remove('hidden');
            this.reset();
        } else {
            alert('Error: ' + data.message);
        }
    } catch (error) {
        alert('An error occurred. Please try again.');
    }
});

// Submit contact form to API
document.getElementById('contact-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const message = Object.fromEntries(formData.entries());
    
    try {
        const response = await fetch(`${API_BASE}/messages.php`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(message)
        });
        
        const data = await response.json();
        
        if (response.ok) {
            document.getElementById('contact-success').classList.remove('hidden');
            this.reset();
        } else {
            alert('Error: ' + data.message);
        }
    } catch (error) {
        alert('An error occurred. Please try again.');
    }
});

// Update the page loading functions
function showPage(pageId) {
    // ... existing code ...
    
    // Load dynamic content if needed
    if (pageId === 'upcoming') {
        loadUpcomingServices();
    } else if (pageId === 'blog') {
        loadBlogPosts();
    }
    // ... rest of existing code ...
}

// Update formatServiceDate function
function formatServiceDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-AU', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
}
</script>